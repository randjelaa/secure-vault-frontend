@if (username) {
  <h2>Welcome, {{ username }}</h2>
} @else {
  <h2>Admin Dashboard</h2>
}

@if (needsVaultSetup) {
  <div class="vault-setup">
    <h3>Initialize Vault</h3>

    <input
      type="password"
      placeholder="Master password"
      [(ngModel)]="masterPassword"
    />

    <button (click)="createVault()">Create Vault</button>
  </div>
} @else {
  <app-vault></app-vault>
}

<hr />

<section class="admin-users">

  <h3>Pending user requests</h3>

  @if (pendingUsers.length > 0) {
    <table>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Created</th>
        <th>Is blocked</th>
        <th>Actions</th>
      </tr>

      @for (user of pendingUsers; track user.id) {
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role }}</td>
          <td>{{ user.createdAt }}</td>
          <td>
            @if (user.blockedAt === null) {
              False
            } @else {
              True
            }
          </td>
          <td>
            <button (click)="approveUser(user.id)">Approve</button>
            <button (click)="deleteUser(user.id)">Reject</button>
          </td>
        </tr>
      }
    </table>
  } @else {
    <p>No pending users</p>
  }

  <hr />

  <h3>Active users</h3>

  @if (activeUsers.length > 0) {
    <table>
      <tr>
        <th>Username</th>
        <th>Email</th>
        <th>Role</th>
        <th>Actions</th>
      </tr>

      @for (user of activeUsers; track user.id) {
        <tr>
          <td>{{ user.username }}</td>
          <td>{{ user.email }}</td>
          <td>{{ user.role }}</td>
          <td>
            <button (click)="deleteUser(user.id)">Delete</button>
          </td>
        </tr>
      }
    </table>
  } @else {
    <p>No active users</p>
  }

  <hr />

  <h3>Create new user</h3>

  <div class="create-user">
    <input
      placeholder="Username"
      [(ngModel)]="newUser.username"
    />

    <input
      placeholder="Email"
      [(ngModel)]="newUser.email"
    />

    <input
      type="password"
      placeholder="Password"
      [(ngModel)]="newUser.password"
    />

    <select [(ngModel)]="newUser.role">
      <option value="ADMIN">ADMIN</option>
      <option value="TEAM_LEAD">TEAM_LEAD</option>
      <option value="DEVELOPER">DEVELOPER</option>
    </select>

    <button (click)="createUser()">Create</button>
  </div>

</section>

<hr />

<section class="security-policy">

  <h3>Security policies</h3>

  @if (policyDraft) {

    <div class="policy-field">
      <label>Minimum master password length</label>
      <input
        type="number"
        min="8"
        [(ngModel)]="policyDraft.minMasterPasswordLength"
      />
    </div>

    <div class="policy-field">
      <label>Access token TTL (seconds)</label>
      <input
        type="number"
        min="30"
        [(ngModel)]="policyDraft.accessTokenTtlSeconds"
      />
    </div>

    <div class="policy-field">
      <label>Refresh token TTL (seconds)</label>
      <input
        type="number"
        min="300"
        [(ngModel)]="policyDraft.refreshTokenTtlSeconds"
      />
    </div>

    <button (click)="savePolicy()">Save policy</button>

    @if (policySaved) {
      <p class="success">Policy updated successfully</p>
    }

    <section class="honeypot">

    <h3>Honeypot / Intrusion Detection</h3>

    <p>
      Status:
      <strong [class.enabled]="honeypotEnabled"
              [class.disabled]="!honeypotEnabled">
        {{ honeypotEnabled ? 'ENABLED' : 'DISABLED' }}
      </strong>
    </p>

    @if (!honeypotEnabled) {
      <button (click)="enableHoneypot()">
        Enable vulnerable endpoint
      </button>
    } @else {
      <button (click)="disableHoneypot()">
        Disable vulnerable endpoint
      </button>
    }
  </section>

  } @else {
    <p>Loading security policy...</p>
  }

</section>

<hr />

<app-logout></app-logout>
